<!DOCTYPE html>
<html>
<head> 
    <meta charset="UTF-8">
    <title>ê³¼ì ì‹¤ì‹œê°„ socket </title>
    <script src="jQuery.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
    <script src="http://195.168.9.208:1234/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="snackClientcss.css">
    
    <script> 
$(function () {
    var socket = io.connect("http://195.168.9.208:1234");

    // ìµœì´ˆ ë°ì´í„° ë¡œë“œ
    getProductData();

    // ê°„ì‹ ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ
    $("#snackRegbutton").click(function () {
        var n = $("#snameInput").val();
        var p = $("#spriceInput").val();

        $.getJSON("http://195.168.9.208:6789/snack.reg?s_name=" + n + "&s_price=" + p, function (regResult) {
            socket.emit("snackRegistered"); // ì‹¤ì‹œê°„ ë“±ë¡ ì‹ í˜¸ ë³´ëƒ„
        });
    });
    //ë°ì´í„° ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ 
    $("#snackUpdbutton").click(function () {
        var n = $("#snameInput").val();
        var p = $("#spriceInput").val();

        $.getJSON("http://195.168.9.208:6789/snack.upd?s_name=" + n + "&s_price=" + p, function (regResult) {
            socket.emit("snackUpdated"); // ì‹¤ì‹œê°„ ìˆ˜ì • ì‹ í˜¸ ë³´ëƒ„
        });
    });
    
    //ë°ì´í„° ì‚­ì œ ë²„íŠ¼ í´ë¦­ì‹œ 
    $("#snackDelbutton").click(function () {
        var n = $("#snameInput").val();
        var p = $("#spriceInput").val();

        $.getJSON("http://195.168.9.208:6789/snack.del?s_name=" + n + "&s_price=" + p, function (regResult) {
            socket.emit("snackDeleted"); // ì‹¤ì‹œê°„ ì‚­ì œ ì‹ í˜¸ ë³´ëƒ„
        });
    });
    
    // ë‹¤ë¥¸ ì‚¬ìš©ìë¡œë¶€í„° ì‹¤ì‹œê°„ ì‹ í˜¸ ë°›ì•˜ì„ ë•Œ
    socket.on("selectAgainAdd", function () {
        alert("ğŸª ìƒˆë¡œìš´ ê°„ì‹ì´ ë“±ë¡ë˜ì—ˆì–´ìš”!");
        getProductData();  // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    });
    socket.on("selectAgainUpd", function () {
        alert("ğŸª ê°„ì‹ì´ ìˆ˜ì •ë˜ì—ˆì–´ìš”!");
        getProductData();  // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    });
    socket.on("selectAgainDel", function () {
        alert("ğŸª ê°„ì‹ì´ ì‚­ì œë˜ì—ˆì–´ìš”!");
        getProductData();  // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    });
    
    
    // ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
    function getProductData() {
        $.getJSON("http://195.168.9.208:6789/snack.get", function (json) {
            var $ul = $("#snack-list");
            $ul.empty();

            $.each(json, function (i, m) {
                var $li = $("<li></li>").append(
                    $("<a href='#'></a>").html(`${m.s_name}<br><span>${m.s_price}ì›</span>`)
                );
                $ul.append($li);
            });

            $ul.listview("refresh");  // jQuery Mobile ìŠ¤íƒ€ì¼ ì ìš©
        });
    }
});
</script>

</head>
<body> 
    <div data-role="page" id="p1">
        <div data-role="header" data-position="fixed">
            <h1>register your own snack</h1>
        </div>
        <div style="margin-top: 1.2em;">
            <label for="snameInput" style="font-weight:600; color:#333;">Snack Name</label>
            <input type="text" placeholder="snack name ì…ë ¥" class="form-input" id="snameInput">
            <label for="spriceInput" style="font-weight:600; color:#333; margin-left: 10px;">Snack Price</label>
            <input type="text" placeholder="snack price ì…ë ¥" class="form-input" id="spriceInput">
        </div>
        <div>
            <button id="snackRegbutton">Register</button>
            <button id="snackDelbutton">Delete</button>
            <button id="snackUpdbutton">Update</button>
        </div>

        <div style="margin-top: 2em;">
            <ul id="snack-list"
                data-role="listview"
                data-inset="true"
                style="background: #fff; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            </ul>
        </div>
    </div>
</body>
</html>
